<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROTOCOL-01 | Arise</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d2ff;
            --secondary: #007bff;
            --bg: #050505;
            --card: #0d1117;
            --text-dim: #555;
            --rank-color: #ffffff;
            --penalty: #ff4444;
        } 
        body { background-color: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; justify-content: center; overflow-x: hidden; }
        .app { width: 100%; max-width: 400px; padding: 20px; padding-bottom: 100px; position: relative; }
        
        .header-section { text-align: center; margin-bottom: 30px; position: relative; padding-top: 10px; }
        .logo-box {
            display: inline-block;
            border: 2px solid var(--primary);
            padding: 10px 20px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.4), inset 0 0 15px rgba(0, 210, 255, 0.2);
            background: rgba(0, 210, 255, 0.05);
            margin-bottom: 35px;
        }
        .logo { color: var(--primary); text-shadow: 0 0 15px rgba(0, 210, 255, 0.8); font-size: 1.8rem; font-weight: 900; margin: 0; letter-spacing: 4px; text-transform: uppercase; }
        
        .signature { 
            position: absolute; 
            left: 50%; transform: translateX(-50%); top: 75px; 
            font-family: 'Dancing Script', cursive;
            font-size: 1.1rem; color: var(--primary); text-shadow: 0 0 8px var(--primary);
            opacity: 0.9; width: 100%;
        }

        .system-msg-box {
            background: rgba(0, 210, 255, 0.05);
            border: 1px solid rgba(0, 210, 255, 0.2);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.8rem;
            color: var(--primary);
            text-align: center;
            font-style: italic;
            border-left: 4px solid var(--primary);
        }

        .rank-badge-top { font-size: 2rem; font-weight: 900; color: var(--rank-color); text-shadow: 0 0 20px var(--rank-color); margin: 15px 0 10px 0; letter-spacing: 3px; text-transform: uppercase; }
        .days-strip { display: flex; justify-content: space-around; background: #111; padding: 12px 5px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; }
        .day { font-size: 0.75rem; color: var(--text-dim); font-weight: 800; }
        .day.active-day { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .streak-badge { background: #1a1a1a; border: 1px solid #ffaa00; color: #ffaa00; padding: 6px 20px; border-radius: 25px; font-weight: bold; font-size: 0.85rem; display: block; width: fit-content; margin: 0 auto 25px auto; text-transform: uppercase; }
        .status-card { background: var(--card); padding: 20px; border-radius: 25px; border: 1px solid #1f2937; margin-bottom: 20px; }
        .status-header { display: flex; justify-content: space-around; font-weight: bold; font-size: 1rem; }
        .progress-container { width: 100%; height: 8px; background: #000; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--primary)); width: 0%; transition: 1s; }
        
        ul { padding: 0; list-style: none; }
        li { background: #0d1117; margin-bottom: 12px; padding: 18px; border-radius: 15px; display: flex; justify-content: space-between; border-left: 4px solid var(--primary); align-items: center; cursor: pointer; }
        .completed-item { opacity: 0.2; filter: grayscale(1); border-left-color: #333 !important; }
        .check-box { width: 22px; height: 22px; border: 2px solid var(--primary); border-radius: 50%; }
        .completed-item .check-box { background: var(--primary); }
        .player-card { border: 2px solid var(--rank-color) !important; text-align: center; }
        .stat-label { color: var(--text-dim); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }

        .timer-header { color: var(--primary); letter-spacing: 4px; font-weight: 900; margin-bottom: 20px; text-transform: uppercase; text-align: center; }
        .timer-box { background: rgba(255,255,255,0.02); padding: 40px 20px; border-radius: 30px; text-align: center; border: 1px solid #222; }
        #countdownDisplay { font-size: 4.5rem; font-family: monospace; text-shadow: 0 0 25px var(--primary); margin-bottom: 20px; }
        .timer-input { background: #000; border: 1px solid var(--primary); color: white; padding: 10px; width: 60px; text-align: center; border-radius: 10px; font-size: 1.1rem; }
        .timer-controls { display: flex; gap: 10px; justify-content: center; }
        .btn-main { border:none; padding:15px 25px; border-radius:12px; font-weight:900; color:black; cursor:pointer; flex: 1; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; max-width: 400px; background: #000; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #222; z-index: 1000; }
        .nav-item { text-align: center; color: #444; cursor: pointer; font-size: 0.75rem; }
        .nav-item.active { color: var(--primary); }
        .hidden { display: none !important; }

        /* Custom System Overlay */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); display: flex; justify-content: center; align-items: center; z-index: 10000; transition: 0.3s; }
        .msg-box { background: #0d1117; border: 2px solid var(--primary); padding: 30px; border-radius: 20px; text-align: center; max-width: 80%; box-shadow: 0 0 30px var(--primary); animation: glow-in 0.5s ease-out; }
        @keyframes glow-in { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .msg-title { color: var(--primary); font-weight: 900; letter-spacing: 2px; margin-bottom: 10px; text-transform: uppercase;}
        .msg-content { color: white; font-size: 1rem; margin-bottom: 20px; }
        .msg-btn { background: var(--primary); color: black; border: none; padding: 10px 30px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .rank-up-glow { box-shadow: 0 0 60px var(--rank-color) !important; border: 3px solid var(--rank-color) !important; transition: 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 50% { transform: translate(-1px, 2px) rotate(1deg); } 100% { transform: translate(1px, -2px) rotate(0deg); } }

        .calendar-day { 
    padding: 10px 0; 
    background: #111; 
    border-radius: 8px; 
    font-size: 0.8rem; 
    border: 1px solid #222; 
    position: relative;
}
.day-complete { border-color: var(--primary); color: var(--primary); }
.day-complete::after { content: '‚úì'; position: absolute; top: 2px; right: 2px; font-size: 0.6rem; }
.day-missed { color: var(--text-dim); }
.today-marker { border: 1px solid #ffaa00 !important; }
    </style>
</head>
<body>

<div id="systemOverlay" class="overlay hidden">
    <div class="msg-box">
        <h2 id="msgTitle" class="msg-title">SYSTEM MESSAGE</h2>
        <p id="msgBody" class="msg-content"></p>
        <button class="msg-btn" onclick="closeOverlay()">CONFIRM</button>
    </div>
</div>

<div class="app">
    <div id="mainHeader" class="header-section">
        <div class="logo-box"><h1 class="logo">PROTOCOL-01</h1></div>
        <div class="signature">made by devil's knock</div>
        <div id="rankBadgeTop" class="rank-badge-top">RANK E</div>
    </div>

    <div id="daysStrip" class="days-strip">
        <div class="day" id="d-0">SUN</div><div class="day" id="d-1">MON</div><div class="day" id="d-2">TUE</div><div class="day" id="d-3">WED</div><div class="day" id="d-4">THU</div><div class="day" id="d-5">FRI</div><div class="day" id="d-6">SAT</div>
    </div>

    <div id="streakBadge" class="streak-badge">üî• STREAK: <span id="streakVal">0</span> DAYS</div>

    <div id="questPage" class="page">
        <div id="motivationMsg" class="system-msg-box">[SYSTEM]: Loading daily parameters...</div>
        <div class="status-card">
            <div class="status-header">
                <span>LVL: <span id="level">1</span></span>
                <span>XP: <span id="xpDisp">0/250</span></span>
            </div>
            <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
        </div>
        <p style="color:var(--penalty); font-size:0.6rem; text-align:center; font-weight:bold; margin-bottom:10px;">[!] 1 DAY MISS = STREAK 0 | 3 DAYS = XP 0</p>
        <ul id="taskList"></ul>
    </div>

    <div id="timerPage" class="page hidden">
        <h2 class="timer-header">FOCUS PROTOCOL</h2>
        <div class="timer-box">
            <div id="tInputArea" style="margin-bottom: 20px;">
                <span style="font-size: 0.8rem; color: var(--text-dim);">FOCUS DURATION (MIN)</span><br><br>
                <input type="number" id="userMins" class="timer-input" value="30">
            </div>
            <div id="countdownDisplay">30:00</div>
            <div class="timer-controls">
                <button onclick="handleTimer()" id="tBtn" class="btn-main" style="background:var(--primary);">ENGAGE</button>
                <button onclick="togglePause()" id="pauseBtn" class="btn-main hidden" style="background:#eee;">PAUSE</button>
            </div>
        </div>
    </div>

    <div id="profilePage" class="page hidden">
        <div class="status-card player-card">
            <p class="stat-label">CURRENT PLAYER STATUS</p>
            <h2 id="pRank" style="font-size: 2.5rem; margin: 10px 0; letter-spacing: 5px;">RANK E</h2>
            <div style="display: flex; justify-content: space-around; border-top: 1px solid #222; padding-top: 15px;">
                <div><p class="stat-label">LEVEL</p><div id="pLevel" style="font-size: 1.5rem; font-weight: 900;">1</div></div>
                <div><p class="stat-label">STREAK</p><div id="pStreak" style="font-size: 1.5rem; font-weight: 900; color: #ffaa00;">0</div></div>
            </div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div class="status-card" style="text-align:center;"><p class="stat-label">STRENGTH</p><h2 id="sStr" style="color:var(--primary); margin:5px 0;">0</h2></div>
            <div class="status-card" style="text-align:center;"><p class="stat-label">INTEL</p><h2 id="sInt" style="color:var(--primary); margin:5px 0;">0</h2></div>
        </div>
        <div class="status-card" style="text-align:center;"><p class="stat-label">TOTAL XP</p><div id="pTotalXp" style="font-weight: bold; margin-top:10px; color: var(--secondary);">0 XP</div></div>
    </div>
    <div id="progressPage" class="page hidden">
    <div class="status-card">
        <h3 class="timer-header" style="font-size: 1.2rem;">RANK PREDICTION</h3>
        <div id="predictionBox" style="font-size: 0.85rem; line-height: 1.6; color: #ccc;">
            Calculating data...
        </div>
    </div>
    
    <div class="status-card">
        <div id="calendarHeader" style="display: flex; justify-content: space-between; margin-bottom: 15px; color: var(--primary); font-weight: bold;">
            <span id="monthDisplay">Month</span>
            <span id="completionRate">0% Done</span>
        </div>
        <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;">
            </div>
    </div>
</div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="playSFX('click'); switchPage('questPage', this)">üìú<p>Quest</p></div>
        <div class="nav-item" onclick="playSFX('click'); switchPage('timerPage', this)">‚è±<p>Focus</p></div>
        <div class="nav-item" onclick="playSFX('click'); switchPage('profilePage', this)">üë§<p>Stats</p></div>
        <div class="nav-item" onclick="playSFX('click'); switchPage('progressPage', this)">üìÖ<p>Progress</p></div>
    </nav>
</div>

<script>
const sounds = {
    click: new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'),
    complete: new Audio('https://assets.mixkit.co/active_storage/sfx/2020/2020-preview.mp3'),
    levelUp: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
    notification: new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3')
};

function playSFX(type) {
    sounds[type].currentTime = 0; 
    sounds[type].play().catch(e => console.log("Sound error"));
}

function showOverlay(title, body) {
    document.getElementById("msgTitle").innerText = title;
    document.getElementById("msgBody").innerText = body;
    document.getElementById("systemOverlay").classList.remove("hidden");
    playSFX('notification');
    document.body.style.animation = "shake 0.5s";
    setTimeout(() => { document.body.style.animation = ""; }, 500);
}

function closeOverlay() {
    document.getElementById("systemOverlay").classList.add("hidden");
    playSFX('click');
}

function triggerWelcome() {
    if (!sessionStorage.getItem("welcomeDone")) {
        showOverlay("SYSTEM INITIALIZED", "Welcome back, Hunter. The Protocol awaits your command.");
        sessionStorage.setItem("welcomeDone", "true");
    }
}

let xp = parseInt(localStorage.getItem("xp")) || 0;
let str = parseInt(localStorage.getItem("statStr")) || 0;
let intel = parseInt(localStorage.getItem("statInt")) || 0;
let streak = parseInt(localStorage.getItem("streak")) || 0;
let missedDays = parseInt(localStorage.getItem("missedDays")) || 0;
let completed = JSON.parse(localStorage.getItem("completed")) || [];
let lastDate = localStorage.getItem("lastDate");
let lastLevel = parseInt(localStorage.getItem("lastLevel")) || 1;

const baseTasks = {
    0: [{n: "Rest Day", t: "STR", v: 1}, {n: "Study: 30m (5 Blocks)", t: "INT", v: 1}],
    1: [{n: "Push-Ups", t: "STR", v: 30}, {n: "Bicep Curls", t: "STR", v: 40}, {n: "Triceps Dips", t: "STR", v: 20}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}],
    2: [{n: "Push-Ups", t: "STR", v: 30}, {n: "Bicep Curls", t: "STR", v: 40}, {n: "Triceps Dips", t: "STR", v: 20}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}],
    3: [{n: "Crunches (15x3)", t: "STR", v: 45}, {n: "Leg Raise (12x3)", t: "STR", v: 36}, {n: "Planks (30s x3)", t: "STR", v: 90}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}],
    4: [{n: "Crunches (15x3)", t: "STR", v: 45}, {n: "Leg Raise (12x3)", t: "STR", v: 36}, {n: "Planks (30s x3)", t: "STR", v: 90}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}],
    5: [{n: "Squats (15x3)", t: "STR", v: 45}, {n: "Step-Ups (10x3)", t: "STR", v: 30}, {n: "Calf-Raises (20x3)", t: "STR", v: 60}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}],
    6: [{n: "Squats (15x3)", t: "STR", v: 45}, {n: "Step-Ups (10x3)", t: "STR", v: 30}, {n: "Calf-Raises (20x3)", t: "STR", v: 60}, {n: "Study: 30m (4 Blocks)", t: "INT", v: 1}]
};

const quotes = ["A weak mind leads to a weak body.", "The system has chosen you.", "Every rep is a step closer.", "Limits are for those without Protocol.", "Pain is temporary. Leveling is forever.", "The only way to survive is to get stronger.", "Your future self is watching."];
const ranks = [{ name: "RANK E", minLvl: 1, color: "#ffffff", multiplier: 1 }, { name: "RANK D", minLvl: 11, color: "#4ade80", multiplier: 1.5 }, { name: "RANK C", minLvl: 21, color: "#3b82f6", multiplier: 2 }, { name: "RANK B", minLvl: 31, color: "#a855f7", multiplier: 2.5 }, { name: "RANK A", minLvl: 41, color: "#f97316", multiplier: 3 }, { name: "RANK S", minLvl: 51, color: "#ef4444", multiplier: 5 }];

function checkPenalty() {
    const today = new Date().toDateString();
    if (lastDate && lastDate !== today) {
        const yesterdayIdx = (new Date(lastDate).getDay());
        if (completed.length < baseTasks[yesterdayIdx].length) {
            streak = 0; missedDays++;
            showOverlay("MISSION FAILED", "Penalty: Daily tasks not completed. Streak reset to 0.");
            if (missedDays >= 3) { xp = 0; missedDays = 0; showOverlay("FATAL ERROR", "3 Days missed. XP has been wiped."); }
        } else { missedDays = 0; }
        completed = [];
        localStorage.setItem("lastDate", today);
        saveData();
    } else if (!lastDate) { localStorage.setItem("lastDate", today); }
}

function getCurrentRank() {
    let lvl = Math.floor(xp / 250) + 1;
    return ranks.slice().reverse().find(r => lvl >= r.minLvl) || ranks[0];
}

function updateUI() {
    let lvl = Math.floor(xp / 250) + 1;
    if (lvl > lastLevel) {
        lastLevel = lvl;
        localStorage.setItem("lastLevel", lvl);
        showOverlay("LEVEL UP!", `Reached LEVEL ${lvl}.`);
    }

    let currentRank = getCurrentRank();
    let lastRank = localStorage.getItem("lastRank") || "RANK E";
    if (currentRank.name !== lastRank) {
        document.querySelector('.msg-box').classList.add('rank-up-glow');
        showOverlay("RANK INCREASED", `You have ascended to ${currentRank.name}!`);
        localStorage.setItem("lastRank", currentRank.name);
        setTimeout(() => document.querySelector('.msg-box').classList.remove('rank-up-glow'), 3000);
    }

    let prog = xp % 250;
    document.documentElement.style.setProperty('--rank-color', currentRank.color);
    document.getElementById("level").innerText = lvl;
    document.getElementById("xpDisp").innerText = `${prog}/250`;
    document.getElementById("progressBar").style.width = (prog/250*100) + "%";
    document.getElementById("streakVal").innerText = streak;
    document.getElementById("rankBadgeTop").innerText = currentRank.name;
    document.getElementById("rankBadgeTop").style.color = currentRank.color;
    document.getElementById("pRank").innerText = currentRank.name;
    document.getElementById("pRank").style.color = currentRank.color;
    document.getElementById("pLevel").innerText = lvl;
    document.getElementById("pStreak").innerText = streak;
    document.getElementById("sStr").innerText = str;
    document.getElementById("sInt").innerText = intel;
    document.getElementById("pTotalXp").innerText = xp + " XP";
}

function renderTasks() {
    const list = document.getElementById("taskList");
    const dayIdx = new Date().getDay();
    const currentRank = getCurrentRank();
    const tasks = baseTasks[dayIdx];
    list.innerHTML = "";
    document.querySelectorAll('.day').forEach(d => d.classList.remove('active-day'));
    document.getElementById(`d-${dayIdx}`).classList.add('active-day');

    tasks.forEach((task, i) => {
        const li = document.createElement("li");
        if(completed.includes(i)) li.classList.add("completed-item");
        let val = task.n.includes("Study") ? task.n : `${task.n}: ${Math.ceil(task.v * currentRank.multiplier)}`;
        li.innerHTML = `<div><small style="color:var(--primary)">${task.t}</small><br><b>${val}</b></div><div class="check-box"></div>`;
        li.onclick = () => {
            if(completed.includes(i)) return;
            playSFX('complete');
            completed.push(i);
            task.t === "STR" ? str += 10 : intel += 10;
            xp += 25;
            if(completed.length === tasks.length) streak++;
            saveData(); updateUI(); renderTasks();
        };
        list.appendChild(li);
    });
}

function saveData() {
    localStorage.setItem("xp", xp);
    localStorage.setItem("statStr", str);
    localStorage.setItem("statInt", intel);
    localStorage.setItem("streak", streak);
    localStorage.setItem("missedDays", missedDays);
    localStorage.setItem("completed", JSON.stringify(completed));
}

function switchPage(pId, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(pId).classList.remove('hidden');
    el.classList.add('active');
    const isQuest = pId === 'questPage';
    document.getElementById("mainHeader").classList.toggle('hidden', !isQuest);
    document.getElementById("daysStrip").classList.toggle('hidden', !isQuest);
    document.getElementById("streakBadge").classList.toggle('hidden', !isQuest);
}

let tInt, tLeft, tActive = false, isPaused = false;
function handleTimer() {
    const btn = document.getElementById("tBtn");
    const pBtn = document.getElementById("pauseBtn");
    if(!tActive) {
        playSFX('click'); 
        tLeft = document.getElementById("userMins").value * 60;
        tActive = true; isPaused = false;
        btn.innerText = "ABORT"; btn.style.background = "#ff4444";
        pBtn.classList.remove('hidden'); pBtn.innerText = "PAUSE";
        tInt = setInterval(() => {
            if(!isPaused) {
                tLeft--;
                let m = Math.floor(tLeft/60), s = tLeft%60;
                document.getElementById("countdownDisplay").innerText = `${m}:${s<10?'0'+s:s}`;
                if(tLeft <= 0) {
                    clearInterval(tInt); tActive=false;
                    intel+=15; xp+=20; saveData(); updateUI();
                    showOverlay("PROTOCOL COMPLETE", "Focus session finished. +20 XP Gained.");
                    btn.innerText = "ENGAGE"; btn.style.background = "var(--primary)";
                    pBtn.classList.add('hidden');
                }
            }
        }, 1000);
    } else {
        clearInterval(tInt); tActive = false;
        btn.innerText = "ENGAGE"; btn.style.background = "var(--primary)";
        pBtn.classList.add('hidden');
        document.getElementById("countdownDisplay").innerText = document.getElementById("userMins").value + ":00";
    }
}

function togglePause() {
    isPaused = !isPaused;
    const pBtn = document.getElementById("pauseBtn");
    pBtn.innerText = isPaused ? "RESUME" : "PAUSE";
    pBtn.style.background = isPaused ? "var(--primary)" : "#eee";
}

window.onload = () => { 
    checkPenalty(); 
    const dayIdx = new Date().getDay();
    document.getElementById("motivationMsg").innerText = `[SYSTEM]: "${quotes[dayIdx]}"`;
    updateUI(); 
    renderTasks(); 
    triggerWelcome(); 
};

// 1. Progress Tracking Logic
let history = JSON.parse(localStorage.getItem("questHistory")) || {};

// Function to mark today's progress
function updateHistory() {
    const today = new Date().toDateString();
    const dayIdx = new Date().getDay();
    const totalToday = baseTasks[dayIdx].length;
    
    if (completed.length === totalToday) {
        history[today] = "complete";
    } else {
        history[today] = "incomplete";
    }
    localStorage.setItem("questHistory", JSON.stringify(history));
}

// 2. Rank Prediction Calculation
function calculatePrediction() {
    const currentXP = xp;
    const currentRank = getCurrentRank();
    const nextRank = ranks[ranks.indexOf(currentRank) + 1] || currentRank;
    
    if (nextRank === currentRank) {
        document.getElementById("predictionBox").innerHTML = "MAX RANK ACHIEVED";
        return;
    }

    const xpNeeded = (nextRank.minLvl - 1) * 250 - currentXP;
    const xpPerDay = 100; // Average (4 tasks * 25xp)

    const daysIfPerfect = Math.ceil(xpNeeded / xpPerDay);
    const daysIfMissedOnce = Math.ceil(xpNeeded / (xpPerDay * 0.8)); // Estimate 20% slowdown

    document.getElementById("predictionBox").innerHTML = `
        Target: <b style="color:${nextRank.color}">${nextRank.name}</b><br>
        ‚Ä¢ <b>${daysIfPerfect} days</b> (Agar roz tasks poore kiye)<br>
        ‚Ä¢ <b>${daysIfMissedOnce} days</b> (Agar beech mein miss hua)
    `;
}

// 3. Calendar Rendering
function renderCalendar() {
    const grid = document.getElementById("calendarGrid");
    const monthDisp = document.getElementById("monthDisplay");
    const now = new Date();
    const month = now.toLocaleString('default', { month: 'long' });
    monthDisp.innerText = `${month} ${now.getFullYear()}`;

    grid.innerHTML = "";
    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();

    let completedCount = 0;

    for (let i = 1; i <= daysInMonth; i++) {
        const dateStr = new Date(now.getFullYear(), now.getMonth(), i).toDateString();
        const dayDiv = document.createElement("div");
        dayDiv.className = "calendar-day";
        dayDiv.innerText = i;

        if (dateStr === now.toDateString()) dayDiv.classList.add("today-marker");

        if (history[dateStr] === "complete") {
            dayDiv.classList.add("day-complete");
            completedCount++;
        } else if (history[dateStr] === "incomplete") {
            dayDiv.classList.add("day-missed");
        }
        grid.appendChild(dayDiv);
    }
    
    document.getElementById("completionRate").innerText = `${Math.round((completedCount/daysInMonth)*100)}% Done`;
}

// Update existing functions
const originalSaveData = saveData;
saveData = function() {
    originalSaveData();
    updateHistory();
    calculatePrediction();
    renderCalendar();
};

// Initialize on page switch
const originalSwitchPage = switchPage;
switchPage = function(pId, el) {
    originalSwitchPage(pId, el);
    if (pId === 'progressPage') {
        calculatePrediction();
        renderCalendar();
    }
};

// Initial Call
updateHistory();
</script>
</body>
</html>
